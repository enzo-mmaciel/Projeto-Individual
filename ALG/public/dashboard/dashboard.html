<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>

  
    <link rel="stylesheet" href="./../css/dashboards.css">
    <link rel="stylesheet" href="./../css/estilo.css" />

   
    <script src="../js/sessao.js"></script>

   
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

  
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Estilos adicionais para o gráfico -->
    <style>
        #graficoResultados {
            width: 300px;
            height: 300px;
        }
    </style>
</head>

<body>

    <!-- Estrutura principal da página -->
    <div class="janela">

        <!-- Cabeçalho do painel -->
        <div class="header-left dash-header">
            <h1>Blog do Santos FC</h1>
            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>
            <!-- Links para outras páginas -->
            <div class="btn-nav-white">
                <a href="cards.html">
                    <h3>Tabela</h3>
                </a>
            </div>
            <div class="btn-nav-white">
                <a href="./dashboard.html">
                    <h3>Quiz</h3>
                </a>
            </div>

            <div class="btn-nav-white">
                <a href="./rank.html">
                    <h3>Ranking</h3>
                </a>
            </div>
            
            <div class="btn-nav-white">
                <a href="./mural.html">
                    <h3>Forum</h3>
                </a>
            </div>
            <!-- Botão de logout -->
            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>
        </div>

        <!-- Conteúdo do painel -->
        <div class="dash">
            <div id="quizContainer">
                <!-- Início do quiz -->
                <div id="inicarQuiz">
                    <h1>Quiz do Santos FC</h1>
                    <p>Quanto você sabe do Santos FC?</p>
                    <button onclick="iniciar()">Jogar</button>
                </div>
                <!-- Perguntas do quiz -->
                <div id="quiz" style="display: none;">
                    <div id="pergunta1" class="pergunta">
                        <h2>Qual é o estádio do Santos FC?</h2>
                        <button onclick="responder(this, 'Vila Belmiro')">Maracanã</button>
                        <button onclick="responder(this, 'Vila Belmiro')">Vila Belmiro</button>
                        <button onclick="responder(this, 'Vila Belmiro')">Pacaembu</button>
                        <button onclick="responder(this, 'Vila Belmiro')">Morumbi</button>
                    </div>
                    <div id="pergunta2" class="pergunta" style="display: none;">
                        <h2>Quantas vezes o Santos FC venceu a Libertadores?</h2>
                        <button onclick="responder(this, '3')">3</button>
                        <button onclick="responder(this, '3')">2</button>
                        <button onclick="responder(this, '3')">4</button>
                        <button onclick="responder(this, '3')">1</button>
                    </div>
                    <div id="pergunta3" class="pergunta" style="display: none;">
                        <h2>Qual título o Santos conquistou em 2011?</h2>
                        <button onclick="responder(this, 'Libertadores')">Brasileiro</button>
                        <button onclick="responder(this, 'Libertadores')">Libertadores</button>
                        <button onclick="responder(this, 'Libertadores')">Mundial de clubes</button>
                        <button onclick="responder(this, 'Libertadores')">Copa do Brasil</button>
                    </div>
                    <div id="pergunta4" class="pergunta" style="display: none;">
                        <h2>Em que ano Neymar estreou no time principal do Santos?</h2>
                        <button onclick="responder(this, '2009')">2010</button>
                        <button onclick="responder(this, '2009')">2008</button>
                        <button onclick="responder(this, '2009')">2011</button>
                        <button onclick="responder(this, '2009')">2009</button>
                    </div>
                    <div id="pergunta5" class="pergunta" style="display: none;">
                        <h2>Qual é o maior rival do Santos FC?</h2>
                        <button onclick="responder(this, 'Corinthians')">Palmeiras</button>
                        <button onclick="responder(this, 'Corinthians')">Corinthians</button>
                        <button onclick="responder(this, 'Corinthians')">São Paulo</button>
                        <button onclick="responder(this, 'Corinthians')">Ponte Preta</button>
                    </div>
                    <div id="pergunta6" class="pergunta" style="display: none;">
                        <h2>Quantos gols Pelé marcou pelo Santos FC?</h2>
                        <button onclick="responder(this, '1091')">987</button>
                        <button onclick="responder(this, '1091')">1087</button>
                        <button onclick="responder(this, '1091')">1091</button>
                        <button onclick="responder(this, '1091')">1147</button>
                    </div>
                    <div id="pergunta7" class="pergunta" style="display: none;">
                        <h2>Em qual ano o Santos Futebol Clube foi fundado?</h2>
                        <button onclick="responder(this, '1912')">1912</button>
                        <button onclick="responder(this, '1912')">1910</button>
                        <button onclick="responder(this, '1912')">1919</button>
                        <button onclick="responder(this, '1912')">1922</button>
                    </div>
                    <div id="pergunta8" class="pergunta" style="display: none;">
                        <h2>Qual foi o maior placar já registrado em um jogo oficial do Santos FC?</h2>
                        <button onclick="responder(this, '11-0')">10-1</button>
                        <button onclick="responder(this, '11-0')">15-0</button>
                        <button onclick="responder(this, '11-0')">11-0</button>
                        <button onclick="responder(this, '11-0')">9-1</button>
                    </div>
                    <div id="pergunta9" class="pergunta" style="display: none;">
                        <h2>Em que ano Pelé marcou seu milésimo gol?</h2>
                        <button onclick="responder(this, '1969')">1970</button>
                        <button onclick="responder(this, '1969')">1969</button>
                        <button onclick="responder(this, '1969')">1966</button>
                        <button onclick="responder(this, '1969')">1959</button>
                    </div>
                    <div id="pergunta10" class="pergunta" style="display: none;">
                        <h2>Quem é o maior goleador do Santos FC após Pelé?</h2>
                        <button onclick="responder(this, 'Pepe')">Pepe</button>
                        <button onclick="responder(this, 'Pepe')">Neymar</button>
                        <button onclick="responder(this, 'Pepe')">Rodrygo</button>
                        <button onclick="responder(this, 'Pepe')">Gabriel Barbosa (Gabigol)</button>
                    </div>
                </div>
                <!-- Resultados do quiz -->
                <div id="resultados" style="display: none;">
                    <h2>Resultados do Quiz</h2>
                    <canvas id="graficoResultados"></canvas>
                    <div id="indicadores">
                        <p>Média de acertos: <span id="media"></span></p>
                        <p>Você está <span id="acimaOuAbaixo"></span> da média.</p>
                        <p>Desempenho: <span id="desempenho"></span></p>
                    </div>
                    <button onclick="voltar()">Tentar Novamente</button> <br>
                    <button onclick="analisar()">Analisar Desempenho pelo Grafico de Barras</button>
                    
                </div>
            </div>
            <!-- Exibição de mensagem -->
            <div id="dizendo"></div>
        </div>
    </div>


    <script>
        // Variáveis para contagem de respostas corretas e erradas
        var respCorreta = 0;
        var respErrada = 0;

        // Define o nome do usuário a partir da sessão
        const b_usuario = document.getElementById('b_usuario');
        if (sessionStorage.NOME_USUARIO) {
            b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
        } else {
            b_usuario.innerHTML = 'usuário';
        }

        // Função para iniciar o quiz
        function iniciar() {
            document.getElementById('inicarQuiz').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';
        }

        // Variáveis de controle das perguntas e total de perguntas
        var perguntaAtual = 1;
        var totalDePerguntas = 10;

        // Função para responder às perguntas
        function responder(botao, respostaCorreta) {
            const respostaSelecionada = botao.textContent;
            if (respostaSelecionada === respostaCorreta) {
                respCorreta++;
            } else {
                respErrada++;
            }
            document.getElementById("pergunta" + perguntaAtual).style.display = "none";
            if (perguntaAtual < totalDePerguntas) {
                perguntaAtual++;
                document.getElementById("pergunta" + perguntaAtual).style.display = "block";
            } else {
                document.getElementById('dizendo').innerHTML = `<button onclick="finalizar()">Finalizar</button>`;
            }

        }

        function finalizar() {
            document.getElementById('quiz').style.display = 'none';
            document.getElementById('dizendo').innerHTML = '';
            document.getElementById('resultados').style.display = 'block';
            mostrarResultados();
        }

       

        // Função para obter o ID do usuário da sessão
        function obterIdUsuario() {
            return sessionStorage.ID_USUARIO || 'desconhecido';
        }

        // Função para exibir os resultados do quiz
        function exibirResultados() {
            const fk_usuario = obterIdUsuario();
            document.getElementById("quiz").style.display = "none";
            document.getElementById("resultados").style.display = "block";

            // Validações para mostrar o percentual do desempenho do usuario após ele jogar o quis -- 21/06/2024
            const totalRespostas = respCorreta + respErrada;
            const media = (respCorreta / totalRespostas) * 100;
            document.getElementById("media").textContent = media.toFixed(2) + "%";

            // Validações para mostrar o percentual do desempenho do usuario após ele jogar o quis -- 21/06/2024
            const mediaGeral = 70;
            if (media >= mediaGeral) {
                document.getElementById("acimaOuAbaixo").textContent = "acima";
            } else {
                document.getElementById("acimaOuAbaixo").textContent = "abaixo";
            }

            // Validações para mostrar o percentual do desempenho do usuario após ele jogar o quis -- 21/06/2024
            var desempenho = '';
            if (media >= 80) {
                desempenho = 'Bom';
            } else if (media >= 50) {
                desempenho = 'Médio';
            } else {
                desempenho = 'Ruim';
            }
            document.getElementById("desempenho").textContent = desempenho;

            // Requisição para salvar os resultados no servidor
            fetch('/medidas/salvar-resultados', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    acertos: respCorreta,
                    erros: respErrada,
                    fk_usuario: fk_usuario
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao salvar resultados');
                }
                return response.json();
            })
            .then(data => {
                console.log('Resultados salvos com sucesso:', data);
            })
            .catch(error => {
                console.error('Erro ao salvar resultados:', error);
            });

            // Configuração e criação do gráfico de resultados em formato de pizza -- 21/06/2024
            const ctx = document.getElementById('graficoResultados').getContext('2d');
            const quizChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Respostas Corretas', 'Respostas Incorretas'],
                    datasets: [{
                        label: 'Quantidade',
                        data: [respCorreta, respErrada],
                        backgroundColor: [
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(255, 99, 132, 0.2)',
                        ],
                        borderColor: [
                            'rgba(75, 192, 192, 1)',
                            'rgba(255, 99, 132, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Função para voltar à página anterior -- 21/06/2024
        function voltar() {
            window.location.href = './dashboard.html';
        }

        // Função para ir à página do grafico de barras -- 02/08/2024
        function analisar() {
            window.location.href = './cards.html';
        }

        // Função para limpar a sessão e sair
        function limparSessao() {
            sessionStorage.clear();
            window.location.href = '../index.html';
        }

        // Função para finalizar o quiz
        function finalizar() {
            insertBanco();
            exibirResultados();
        }

        // Função para inserir os resultados no banco de dados
        function insertBanco() {
            fetch("/usuarios/insert_banco", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    respCorretaServer: respCorreta,
                    respErradaServer: respErrada,
                    idUsuarioServer: sessionStorage.ID_USUARIO,
                }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Resultados inseridos com sucesso:', data);
            })
            .catch(error => {
                console.error('Erro ao inserir resultados:', error);
            });
        }

        // Função para mostrar o resultado do quiz
        function showQuiz() {
            fetch("/usuarios/showQuiz", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    idUsuarioServer: sessionStorage.ID_USUARIO
                })
            })
            .then(response => response.json())
            .then(data => {
                var resultado = data.resultadoShowQuiz[0];
                respCorretaDash = resultado.acertos;
                respErradaDash = resultado.erros;
            })
            .catch(error => {
                console.error('Erro ao obter quiz:', error);
            });
        }

        // Chamada para mostrar o quiz após um tempo
        setTimeout(showQuiz, 200);

    </script>

</body>

</html>